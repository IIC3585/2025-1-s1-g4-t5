---
import BaseLayout from '../../../layouts/BaseLayout.astro';
import IngredientScaler from '../../../components/IngredientScaler.svelte'; // Isla Svelte
import StepAssistant from '../../../components/StepAssistant.jsx'; // Isla React

export async function getStaticPaths() {
  const response = await fetch('https://www.themealdb.com/api/json/v1/1/filter.php?c=Seafood');
  const data = await response.json();
  const mealsList = data.meals;

  const detailedMeals = await Promise.all(
    mealsList.map(async (meal) => {
      const detailResponse = await fetch(`https://www.themealdb.com/api/json/v1/1/lookup.php?i=${meal.idMeal}`);
      const detailData = await detailResponse.json();
      return detailData.meals[0];
    })
  );

  return detailedMeals.map((meal) => {
    const ingredients = [];
    for (let i = 1; i <= 20; i++) {
      if (meal[`strIngredient${i}`]) {
        ingredients.push({
          name: meal[`strIngredient${i}`],
          measure: meal[`strMeasure${i}`],
        });
      }
    }

    return {
      params: { id: meal.idMeal },
      props: { meal, ingredients },
    };
  });
}

const { meal, ingredients } = Astro.props;
---
<BaseLayout title={meal.strMeal}>
  <h1>{meal.strMeal}</h1>
  <img src={meal.strMealThumb} alt={meal.strMeal} width="500"/>
  <p><em>Categor√≠a: {meal.strCategory} | Origen: {meal.strArea}</em></p>

  <hr/>

  <h2>Ingredientes</h2>
  <IngredientScaler client:visible ingredients={ingredients} />

  <hr/>

  <h2>Instrucciones</h2>
  <StepAssistant client:load instructions={meal.strInstructions} />
</BaseLayout>